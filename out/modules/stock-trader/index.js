"use strict";
/**
 * Stock Trader Entry File
 *
 * @format
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/***** Imports *****/
const puppeteer_1 = __importDefault(require("puppeteer"));
const tk_module_json_1 = require("./tk-module.json");
const Sleep_1 = __importDefault(require("../../core/utils/Sleep"));
const OrderMaker_1 = __importDefault(require("../../../src/modules/stock-trader/OrderMaker"));
const Module_1 = require("../../../src/core/lib/Module");
const ElementAbuse_1 = require("../../../src/modules/stock-trader/ElementAbuse");
const QueryStrings_json_1 = require("../../../src/modules/stock-trader/QueryStrings.json");
/***** Setup *****/
class StockTrader extends Module_1.Module {
    config = this._config.getConfig();
    logger = this.Logger.scope("Mods.StockTrader");
    constructor() {
        super(tk_module_json_1.meta.name, tk_module_json_1.meta.id, tk_module_json_1.meta.version, tk_module_json_1.meta.type, tk_module_json_1.meta.requires);
        this.logger.start(`Initializing ${tk_module_json_1.meta.name}`);
        this.logger.info(`Module Version: ${tk_module_json_1.meta.version}`);
        this.logger.info(`Module ID: ${tk_module_json_1.meta.id}`);
        this.startTime(this._name); // Start logger timer without timer auto log
        this.setupPuppeteer().then((_) => {
            this.logger.complete(`Spawned. Took ${this.stopTime().span}ms. Closing Puppet...`);
        });
    }
    startTime(label) {
        this.logger.disable();
        this.logger.time(label);
        this.logger.enable();
    }
    stopTime() {
        let time;
        this.logger.disable();
        time = this.logger.timeEnd();
        this.logger.enable();
        return time;
    }
    async setupPuppeteer() {
        this.logger.info(`Launching Puppet...`);
        const Browser = await puppeteer_1.default.launch({ headless: this.config.Puppet.headless });
        let Pages = await Browser.pages();
        this.logger.info(`Changing Viewport Size to 1000x850...`);
        await Pages[0].setViewport({
            width: 1000,
            height: 850,
        });
        await this.loginToTradingView(Browser);
        this.logger.await(`Logging into TradingView...`);
    }
    async loginToTradingView(browser) {
        let self = this, page = await browser.pages(), QS = QueryStrings_json_1.Login.TradingView;
        this.logger.pending(`Heading to ${this.config.Puppet.initLink}`);
        page[0].goto(this.config.Puppet.initLink).then(execute);
        async function execute() {
            await (0, ElementAbuse_1.clickEl)(QS.button.UserMenu, page[0]);
            await (0, ElementAbuse_1.clickEl)(QS.button.SignIn, page[0]);
            await (0, ElementAbuse_1.clickEl)(QS.button.Email, page[0]);
            await (0, ElementAbuse_1.typeEl)(QS.input.Username, page[0], self.config.Auth.TradingView.user);
            await (0, ElementAbuse_1.typeEl)(QS.input.Password, page[0], self.config.Auth.TradingView.pass);
            await (0, ElementAbuse_1.clickEl)(QS.button.Submit, page[0]);
            (0, Sleep_1.default)(2000);
            self.logger.await(`Opening Orders...`);
            await self.loginToBroker(browser);
        }
        //execute.name;
    }
    async loginToBroker(browser) {
        let self = this, page = await browser.pages(), QS = QueryStrings_json_1.Login.Broker;
        this.logger.pending(`Heading to ${this.config.Puppet.chartLink}`);
        page[0].goto(this.config.Puppet.chartLink).then(execute);
        async function execute() {
            try {
                page[0].$(QS.grid.OrderPanel);
            }
            catch (e) {
                self.logger.error(`Order Button was already button somehow ???\n${e}`);
                (0, ElementAbuse_1.clickEl)(QS.button.OrderPanel, page[0]);
            }
            finally {
                (0, Sleep_1.default)(3000);
                await (await page[0].$(QS.grid.EightCap)).hover();
                (0, Sleep_1.default)(500);
                await (0, ElementAbuse_1.clickEl)(QS.button.EightCap, page[0]);
                await (0, ElementAbuse_1.typeEl)(QS.input.Username, page[0], self.config.Auth.EightCap.user);
                await (0, ElementAbuse_1.typeEl)(QS.input.Password, page[0], self.config.Auth.EightCap.pass);
                await (0, ElementAbuse_1.clickEl)(QS.button.Submit, page[0]);
            }
            (0, Sleep_1.default)(4000);
            new OrderMaker_1.default(page[0], self.logger).buy().order("stoplimit").lots(1).setValue(6, 10000).setValue(0, 12000);
            //execute.name;
        }
    }
}
new StockTrader();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbW9kdWxlcy9zdG9jay10cmFkZXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7Ozs7O0FBRUgscUJBQXFCO0FBQ3JCLDBEQUFrQztBQUNsQyxxREFBd0M7QUFDeEMsbUVBQTJDO0FBQzNDLDhGQUFzRTtBQUN0RSx5REFBMkU7QUFDM0UsaUZBQWlGO0FBQ2pGLDJGQUF5RjtBQTBCekYsbUJBQW1CO0FBQ25CLE1BQU0sV0FBWSxTQUFRLGVBQU07SUFDckIsTUFBTSxHQUFzQixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3ZELE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRXZEO1FBQ0MsS0FBSyxDQUFDLHFCQUFJLENBQUMsSUFBSSxFQUFFLHFCQUFJLENBQUMsRUFBRSxFQUFFLHFCQUFJLENBQUMsT0FBTyxFQUFtQixxQkFBSSxDQUFDLElBQUksRUFBdUIscUJBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUV4RyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IscUJBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixxQkFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxxQkFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFMUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyw0Q0FBNEM7UUFFeEUsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ2hDLElBQUksQ0FBQyxNQUFN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SyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1RyxlQUFlO1FBQ2hCLENBQUM7SUFDRixDQUFDO0NBQ0Q7QUFFRCxJQUFJLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFN0b2NrIFRyYWRlciBFbnRyeSBGaWxlXHJcbiAqXHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG4vKioqKiogSW1wb3J0cyAqKioqKi9cclxuaW1wb3J0IFB1cHBldGVlciBmcm9tIFwicHVwcGV0ZWVyXCI7XHJcbmltcG9ydCB7IG1ldGEgfSBmcm9tIFwiLi90ay1tb2R1bGUuanNvblwiO1xyXG5pbXBvcnQgU2xlZXAgZnJvbSBcIi4uLy4uL2NvcmUvdXRpbHMvU2xlZXBcIjtcclxuaW1wb3J0IE9yZGVyTWFrZXIgZnJvbSBcIi4uLy4uLy4uL3NyYy9tb2R1bGVzL3N0b2NrLXRyYWRlci9PcmRlck1ha2VyXCI7XHJcbmltcG9ydCB7IElNb2RDb25maWcsIE1vZHVsZSwgSU1vZHVsZSB9IGZyb20gXCIuLi8uLi8uLi9zcmMvY29yZS9saWIvTW9kdWxlXCI7XHJcbmltcG9ydCB7IGNsaWNrRWwsIHR5cGVFbCB9IGZyb20gXCIuLi8uLi8uLi9zcmMvbW9kdWxlcy9zdG9jay10cmFkZXIvRWxlbWVudEFidXNlXCI7XHJcbmltcG9ydCB7IExvZ2luIGFzIExvZ2luRmxvdyB9IGZyb20gXCIuLi8uLi8uLi9zcmMvbW9kdWxlcy9zdG9jay10cmFkZXIvUXVlcnlTdHJpbmdzLmpzb25cIjtcclxuXHJcbi8qKioqKiBJbnRlcmZhY2VzICoqKioqL1xyXG5pbnRlcmZhY2UgU3RvY2tUcmFkZXJDb25maWcgZXh0ZW5kcyBJTW9kQ29uZmlnIHtcclxuXHRBdXRoOiB7XHJcblx0XHRUcmFkaW5nVmlldzoge1xyXG5cdFx0XHR1c2VyOiBzdHJpbmc7XHJcblx0XHRcdHBhc3M6IHN0cmluZztcclxuXHRcdH07XHJcblx0XHRFaWdodENhcDoge1xyXG5cdFx0XHR1c2VyOiBzdHJpbmc7XHJcblx0XHRcdHBhc3M6IHN0cmluZztcclxuXHRcdH07XHJcblx0fTtcclxuXHRQdXBwZXQ6IHtcclxuXHRcdGhlYWRsZXNzOiBib29sZWFuO1xyXG5cdFx0aW5pdExpbms6IHN0cmluZztcclxuXHRcdGNoYXJ0TGluazogc3RyaW5nO1xyXG5cclxuXHRcdFZpZXc6IHtcclxuXHRcdFx0d2lkdGg6IG51bWJlcjtcclxuXHRcdFx0aGVpZ2h0OiBudW1iZXI7XHJcblx0XHR9O1xyXG5cdH07XHJcbn1cclxuXHJcbi8qKioqKiBTZXR1cCAqKioqKi9cclxuY2xhc3MgU3RvY2tUcmFkZXIgZXh0ZW5kcyBNb2R1bGUge1xyXG5cdHByb3RlY3RlZCBjb25maWcgPSA8U3RvY2tUcmFkZXJDb25maWc+dGhpcy5fY29uZmlnLmdldENvbmZpZygpO1xyXG5cdHByaXZhdGUgbG9nZ2VyID0gdGhpcy5Mb2dnZXIuc2NvcGUoXCJNb2RzLlN0b2NrVHJhZGVyXCIpO1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKG1ldGEubmFtZSwgbWV0YS5pZCwgbWV0YS52ZXJzaW9uLCA8SU1vZHVsZS5Nb2RUeXBlPm1ldGEudHlwZSwgPElNb2R1bGUuTW9kUmVxdWlyZXM+bWV0YS5yZXF1aXJlcyk7XHJcblxyXG5cdFx0dGhpcy5sb2dnZXIuc3RhcnQoYEluaXRpYWxpemluZyAke21ldGEubmFtZX1gKTtcclxuXHRcdHRoaXMubG9nZ2VyLmluZm8oYE1vZHVsZSBWZXJzaW9uOiAke21ldGEudmVyc2lvbn1gKTtcclxuXHRcdHRoaXMubG9nZ2VyLmluZm8oYE1vZHVsZSBJRDogJHttZXRhLmlkfWApO1xyXG5cclxuXHRcdHRoaXMuc3RhcnRUaW1lKHRoaXMuX25hbWUpOyAvLyBTdGFydCBsb2dnZXIgdGltZXIgd2l0aG91dCB0aW1lciBhdXRvIGxvZ1xyXG5cclxuXHRcdHRoaXMuc2V0dXBQdXBwZXRlZXIoKS50aGVuKChfKSA9PiB7XHJcblx0XHRcdHRoaXMubG9nZ2VyLmNvbXBsZXRlKGBTcGF3bmVkLiBUb29rICR7dGhpcy5zdG9wVGltZSgpLnNwYW59bXMuIENsb3NpbmcgUHVwcGV0Li4uYCk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgc3RhcnRUaW1lKGxhYmVsOiBzdHJpbmcpOiB2b2lkIHtcclxuXHRcdHRoaXMubG9nZ2VyLmRpc2FibGUoKTtcclxuXHRcdHRoaXMubG9nZ2VyLnRpbWUobGFiZWwpO1xyXG5cdFx0dGhpcy5sb2dnZXIuZW5hYmxlKCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHN0b3BUaW1lKCk6IHsgbGFiZWw6IHN0cmluZzsgc3Bhbj86IG51bWJlciB9IHtcclxuXHRcdGxldCB0aW1lO1xyXG5cclxuXHRcdHRoaXMubG9nZ2VyLmRpc2FibGUoKTtcclxuXHRcdHRpbWUgPSB0aGlzLmxvZ2dlci50aW1lRW5kKCk7XHJcblx0XHR0aGlzLmxvZ2dlci5lbmFibGUoKTtcclxuXHJcblx0XHRyZXR1cm4gdGltZTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgYXN5bmMgc2V0dXBQdXBwZXRlZXIoKSB7XHJcblx0XHR0aGlzLmxvZ2dlci5pbmZvKGBMYXVuY2hpbmcgUHVwcGV0Li4uYCk7XHJcblx0XHRjb25zdCBCcm93c2VyID0gYXdhaXQgUHVwcGV0ZWVyLmxhdW5jaCh7IGhlYWRsZXNzOiB0aGlzLmNvbmZpZy5QdXBwZXQuaGVhZGxlc3MgfSk7XHJcblx0XHRsZXQgUGFnZXMgPSBhd2FpdCBCcm93c2VyLnBhZ2VzKCk7XHJcblxyXG5cdFx0dGhpcy5sb2dnZXIuaW5mbyhgQ2hhbmdpbmcgVmlld3BvcnQgU2l6ZSB0byAxMDAweDg1MC4uLmApO1xyXG5cdFx0YXdhaXQgUGFnZXNbMF0uc2V0Vmlld3BvcnQoe1xyXG5cdFx0XHR3aWR0aDogMTAwMCxcclxuXHRcdFx0aGVpZ2h0OiA4NTAsXHJcblx0XHR9KTtcclxuXHJcblx0XHRhd2FpdCB0aGlzLmxvZ2luVG9UcmFkaW5nVmlldyhCcm93c2VyKTtcclxuXHRcdHRoaXMubG9nZ2VyLmF3YWl0KGBMb2dnaW5nIGludG8gVHJhZGluZ1ZpZXcuLi5gKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgYXN5bmMgbG9naW5Ub1RyYWRpbmdWaWV3KGJyb3dzZXI6IFB1cHBldGVlci5Ccm93c2VyKSB7XHJcblx0XHRsZXQgc2VsZiA9IHRoaXMsXHJcblx0XHRcdHBhZ2UgPSBhd2FpdCBicm93c2VyLnBhZ2VzKCksXHJcblx0XHRcdFFTID0gTG9naW5GbG93LlRyYWRpbmdWaWV3O1xyXG5cclxuXHRcdHRoaXMubG9nZ2VyLnBlbmRpbmcoYEhlYWRpbmcgdG8gJHt0aGlzLmNvbmZpZy5QdXBwZXQuaW5pdExpbmt9YCk7XHJcblx0XHRwYWdlWzBdLmdvdG8odGhpcy5jb25maWcuUHVwcGV0LmluaXRMaW5rKS50aGVuKGV4ZWN1dGUpO1xyXG5cclxuXHRcdGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGUoKSB7XHJcblx0XHRcdGF3YWl0IGNsaWNrRWwoUVMuYnV0dG9uLlVzZXJNZW51LCBwYWdlWzBdKTtcclxuXHRcdFx0YXdhaXQgY2xpY2tFbChRUy5idXR0b24uU2lnbkluLCBwYWdlWzBdKTtcclxuXHRcdFx0YXdhaXQgY2xpY2tFbChRUy5idXR0b24uRW1haWwsIHBhZ2VbMF0pO1xyXG5cdFx0XHRhd2FpdCB0eXBlRWwoUVMuaW5wdXQuVXNlcm5hbWUsIHBhZ2VbMF0sIHNlbGYuY29uZmlnLkF1dGguVHJhZGluZ1ZpZXcudXNlcik7XHJcblx0XHRcdGF3YWl0IHR5cGVFbChRUy5pbnB1dC5QYXNzd29yZCwgcGFnZVswXSwgc2VsZi5jb25maWcuQXV0aC5UcmFkaW5nVmlldy5wYXNzKTtcclxuXHRcdFx0YXdhaXQgY2xpY2tFbChRUy5idXR0b24uU3VibWl0LCBwYWdlWzBdKTtcclxuXHRcdFx0U2xlZXAoMjAwMCk7XHJcblxyXG5cdFx0XHRzZWxmLmxvZ2dlci5hd2FpdChgT3BlbmluZyBPcmRlcnMuLi5gKTtcclxuXHRcdFx0YXdhaXQgc2VsZi5sb2dpblRvQnJva2VyKGJyb3dzZXIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vZXhlY3V0ZS5uYW1lO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBhc3luYyBsb2dpblRvQnJva2VyKGJyb3dzZXI6IFB1cHBldGVlci5Ccm93c2VyKSB7XHJcblx0XHRsZXQgc2VsZiA9IHRoaXMsXHJcblx0XHRcdHBhZ2UgPSBhd2FpdCBicm93c2VyLnBhZ2VzKCksXHJcblx0XHRcdFFTID0gTG9naW5GbG93LkJyb2tlcjtcclxuXHJcblx0XHR0aGlzLmxvZ2dlci5wZW5kaW5nKGBIZWFkaW5nIHRvICR7dGhpcy5jb25maWcuUHVwcGV0LmNoYXJ0TGlua31gKTtcclxuXHRcdHBhZ2VbMF0uZ290byh0aGlzLmNvbmZpZy5QdXBwZXQuY2hhcnRMaW5rKS50aGVuKGV4ZWN1dGUpO1xyXG5cclxuXHRcdGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGUoKSB7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0cGFnZVswXS4kKFFTLmdyaWQuT3JkZXJQYW5lbCk7XHJcblx0XHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRzZWxmLmxvZ2dlci5lcnJvcihgT3JkZXIgQnV0dG9uIHdhcyBhbHJlYWR5IGJ1dHRvbiBzb21laG93ID8/P1xcbiR7ZX1gKTtcclxuXHRcdFx0XHRjbGlja0VsKFFTLmJ1dHRvbi5PcmRlclBhbmVsLCBwYWdlWzBdKTtcclxuXHRcdFx0fSBmaW5hbGx5IHtcclxuXHRcdFx0XHRTbGVlcCgzMDAwKTtcclxuXHRcdFx0XHRhd2FpdCAoYXdhaXQgcGFnZVswXS4kKFFTLmdyaWQuRWlnaHRDYXApKS5ob3ZlcigpO1xyXG5cdFx0XHRcdFNsZWVwKDUwMCk7XHJcblx0XHRcdFx0YXdhaXQgY2xpY2tFbChRUy5idXR0b24uRWlnaHRDYXAsIHBhZ2VbMF0pO1xyXG5cdFx0XHRcdGF3YWl0IHR5cGVFbChRUy5pbnB1dC5Vc2VybmFtZSwgcGFnZVswXSwgc2VsZi5jb25maWcuQXV0aC5FaWdodENhcC51c2VyKTtcclxuXHRcdFx0XHRhd2FpdCB0eXBlRWwoUVMuaW5wdXQuUGFzc3dvcmQsIHBhZ2VbMF0sIHNlbGYuY29uZmlnLkF1dGguRWlnaHRDYXAucGFzcyk7XHJcblx0XHRcdFx0YXdhaXQgY2xpY2tFbChRUy5idXR0b24uU3VibWl0LCBwYWdlWzBdKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRTbGVlcCg0MDAwKTtcclxuXHRcdFx0bmV3IE9yZGVyTWFrZXIocGFnZVswXSwgc2VsZi5sb2dnZXIpLmJ1eSgpLm9yZGVyKFwic3RvcGxpbWl0XCIpLmxvdHMoMSkuc2V0VmFsdWUoNiwgMTAwMDApLnNldFZhbHVlKDAsIDEyMDAwKTtcclxuXHRcdFx0Ly9leGVjdXRlLm5hbWU7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5uZXcgU3RvY2tUcmFkZXIoKTtcclxuIl19